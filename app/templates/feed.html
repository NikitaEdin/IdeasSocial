{% extends 'base_with_menu.html' %}

{% block page_content %}
        <!-- Main centre column  -->
        <div class="">
            <!-- Flash messages -->
            {% with messages = get_flashed_messages(with_categories=true) %}
              <!--  any messages? -->
              {% if messages %}
                  <!-- loop messages -->
                  {% for category, message in messages %}
                      <div class="alert alert-{{category}} alert-dismissible fade show" role="alert">
                          {{ message}}
                          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                      </div>
                  {% endfor %}

              {% endif %}
           {% endwith %}


           <h3>Ideas Feed</h3>
           <hr>
            <!-- Posts -->
            <div class="mt-3">
                {% if posts.items %}
                    {% for post in posts %}
                    <div class="card card-post my-3">
                        
                        <div class="px-3 pt-2 d-flex justify-content-between align-items-center" >
                        <!-- Header-LEFT (user name & pfp) -->
                            <div class="d-flex align-items-start" >
                                <div class="d-flex align-items-center" >
                                    <img src="{{ post.author.get_pfp() }}" class="me-2 rounded-circle" style="width:50px;">
                                    <a class="card-title d-flex align-content-between">
                                        <a href="{{ url_for('profile') if current_user.is_authenticated and post.author.id == current_user.id else url_for('user_profile', id=post.author.id) }}"
                                        class="fs-6 text-decoration-none">{{ post.author.get_full_name() }}</a>
                                    </a>
                                </div>
                            </div>
                            <!-- Header-RIGHT (options) -->
                            <div class="d-flex align-items-center ">
                                <a href="{{ url_for('view_post', post_id=post.id) }}" class="text-decoration-none text-muted2">
                                    <i class="fas fa-eye me-1 "></i>
                                    <span>View Post</span>
                                </a>
                            </div>

                        </div>
                        
                        <!-- Body -->
                        <div class="card-body pt-1" >
                            <!-- Post Title -->
                            <h5 class="fw-medium my-0">{{ post.title }}</h5>

                            <!-- Post Content -->
                            <p class="fs-6 fw-light text-muted">
                                {{ post.content[:100] }}{% if post.content|length > 100 %}...{% endif %}
                            </p>
                            <div class="d-flex justify-content-between">
                                {% include 'posts/like_comp.html' %}

                                <div>
                                    <span class="fs-6 fw-light text-muted2"> <span class="fas fa-clock"> </span>
                                        {{ post.humanized_time }} 
                                    </span>
                                </div>
                            </div>
                        
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                <!-- No followed users? -->
                    <p class="fs-3 text-center">No posts from followed users.</p>
                    <p class="text-muted text-center">Follow other users to see their posts here in your feed.</p>      

                    <div class="d-flex justify-content-center">
                        <img src="{{ url_for('static', filename='images/followers.png') }}" style="width: 350px;" alt="Followers" class="img-fluid mb-4">       
                    </div>
                {% endif %}
            </div>

        </div>

        
        {% set pagination = posts %}
        {% include 'pagination.html' %}

        <!-- Likes script -->
{% include 'posts/like_script.html' %}
        
{% endblock %}

